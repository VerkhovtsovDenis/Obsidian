# Базы данных: реляционные и не только

В этой теме вы узнаете, что такое базы данных и как они устроены, а также познакомитесь с SQL — языком, на котором пишут команды для управления реляционными базами данных.

![](https://pictures.s3.yandex.net/resources/6_1_1718353529.png)

Без практики точно не останетесь: вы будете создавать таблицы в базе данных, писать запросы на SQL, сохранять и извлекать информацию.

## Зачем мне это?

Работа с базами данных — один из тех навыков, без которых бэкенд-разработчик неконкурентоспособен, а умение написать SQL-запрос вполне может пригодиться на собеседовании при устройстве на работу.

Удачи в учёбе!

## Что такое базы данных

Управление данными — это большая часть работы в любом проекте. Информация о пользователях, описания и цены на товары, географические координаты — всё это данные, которые необходимо сохранять, обрабатывать и предоставлять пользователям.

Для хранения информации придумали **базы данных** — системы для хранения информации и доступа к ней.

База данных чем-то похожа на библиотеку: информация упорядочена, структурирована и разложена по полочкам. Этой информацией нужно как-то управлять.

Даже если посетитель библиотеки точно знает, какая книга ему нужна — требуется умение, чтобы найти запрошенную книгу среди тысяч томов.

А ведь запрос может быть и не точным: «Знаете, это была такая зелёная книжка, на корешке надпись золотом и вензеля, про путешествие вокруг света по какой-то там параллели, ничего больше не помню». Эти задачи решает библиотекарь: он хорошо ориентируется в хранилище и знает, как найти нужную книгу. «Это же „Дети капитана Гранта“ из „Библиотеки приключений“! Сейчас принесу».

Базе данных тоже нужен такой управляющий: нет смысла хранить информацию, если ей нельзя воспользоваться.

### Система управления базами данных

Роль библиотекаря в базах данных выполняет **система управления базами данных**, **СУБД**.

Стоит дать ей команду, и она:

- создаст базу или таблицу в базе;
- внесёт новые данные или удалит ненужные;
- получит из базы нужную информацию по заданному условию;

![](https://pictures.s3.yandex.net/resources/61_1678057530.png)

Для разработчика понятия «база данных» и «СУБД» — близнецы-братья, синонимы, хотя на самом деле это две разные сущности. Когда мы говорим «в проекте используется такая-то база данных» (например, SQLite или Postgres), подразумевается не только сама база, но и её СУБД.

По способу хранения информации базы данных разделяют на две большие группы: реляционные и нереляционные.

## Реляционные базы данных

Реляционную базу данных можно представить в виде **набора таблиц с информацией**, хранящихся в одном пространстве — вроде excel-файлов, которые лежат в одной папке.

![](https://pictures.s3.yandex.net/resources/sprint2_picture2_1682503224.png)

Каждая строка таблицы в БД — это отдельная запись о каком-то объекте. В полях записи (в ячейках) могут храниться различные характеристики этого объекта. Каждый столбец таблицы должен иметь уникальное имя.

Таблица — это набор данных. Поэтому таблицам, как правило, дают названия во множественном числе, например — «заказы» (orders), «фильмы» (movies), «авторы» (authors). Но это — не обязательное правило.

Вот простая таблица **video_products**, в ней собрана информация о нескольких кинолентах. Эти произведения объединяет лишь одно: в них упоминается [выдуманная корпорация ACME](https://ru.wikipedia.org/wiki/Acme_Corporation) и товары, произведённые этой компанией.

![](https://pictures.s3.yandex.net/resources/S2_130_1682532460.png)

Столбцам таблиц в БД принято давать имена в единственном числе, предельно короткие и содержательные, точно как переменным в Python.

Элементы таблицы в реляционных базах данных принято называть так:

- **Запись (строка)** — это строка в таблице. Можно сказать «Таблица **video_products** содержит четыре строки», а можно — «четыре записи».
- **Поле (столбец, колонка)** — это столбец таблицы или ячейка одной записи. Например: «В столбце `product_type` хранится тип видеопродукта». Или так: «В поле `release_year` хранится дата выхода видеопродукта». Но можно сказать и так: «В записи о фильме „Кто подставил кролика Роджера“ в поле `release_year` хранится значение `1988`».

![](https://pictures.s3.yandex.net/resources/S02_133_1697193717.png)

### Типы данных в таблицах

В столбце таблицы реляционной БД могут храниться **данные строго одного типа**; тип данных для столбца задаётся при создании таблицы. Например, колонка `release_year` в приведённом примере хранит данные типа «целое число», и при попытке записать в это поле значение другого типа возникнет ошибка.

Самые востребованные типы полей:

- **Целое число**, как `int` в Python.
- **Число с плавающей точкой**, как `float` в Python.
- **Строка**, как `str` в Python (обычно применяется для коротких строк: названий, заголовков).
- **Текст**, как `str` в Python, но применяется для больших строк (например, для хранения текстов статей).
- **Булев тип:** логический тип данных. `True` или `False`.
- **Дата и время**. В базах данных обычно есть несколько специализированных типов для хранения дат, времени или временных интервалов.

Помимо базовых типов, могут применяться и специальные, например — для хранения картографической информации, для работы с денежными единицами, для адресов компьютеров в сети или данных в формате JSON или XML.

Есть много различных реляционных баз данных, и разные базы поддерживают разные наборы типов данных. При изучении Django вы будете работать в основном с базой **SQLite**; это компактная и лёгкая база, но она поддерживает только пять типов данных:

- INTEGER — целое число;
- REAL — дробное число;
- TEXT — строка;
- BLOB — двоичные данные;
- NULL — специальное значение, означающее отсутствие информации.

Поэтому при работе с SQLite приходится идти на всякие хитрости:

- логические значения `True` и `False` хранятся в поле типа `INTEGER` в виде значений 0 и 1;
- при работе со временем и датой значения в базе данных сохраняют в виде строк или чисел.

Но эти преобразования (например, преобразование `True` в `1` или даты в строковое значение) происходят «под капотом»; в большинстве случаев разработчику не приходится об этом думать.

### Связи между таблицами

Реляционная база данных может содержать множество таблиц с различными данными, и эти данные могут быть связаны между собой.

Вернёмся к таблице с видеопроизведениями: у каждого фильма есть режиссёр (а то и несколько), и о каждом режиссёре в БД можно хранить какую-то дополнительную информацию.

Для примера создадим таблицу, где будет имя режиссёра и год его рождения:

![](https://pictures.s3.yandex.net/resources/S2_131_1682532488.png)

Каждый из этих режиссёров снимал какой-то фильм, упомянутый в таблице **video_products**; название произведения должно быть связано с его именем. Для этого в каждой записи таблицы **video_products** можно указать, с какой записью в таблице **directors** связана эта запись.

Для организации связей между таблицами нужно твёрдо знать, какая запись на какую ссылается. Точный «адрес» каждой записи в таблице определяется уникальным идентификатором, **первичным ключом** (англ. _primary key_, **PK**). Этот ключ хранится в одном из полей таблицы; PK должен быть уникален в пределах таблицы.

В таблице **directors** первичные ключи записей хранятся в колонке `id`.

### Налаживаем связи

В ссылающейся таблице создают специальное поле для **внешнего ключа** (англ. _foreign key,_ **FK**); при создании этого поля указывается, на какую таблицу оно ссылается. В записях в этом поле указывается, на какой PK другой таблицы ссылается это поле.

В таблице **video_products** создадим дополнительную колонку `director_id` — это будет **Foreign Key**, колонка, ссылающаяся на таблицу **directors**; в этой колонке в каждой строке укажем идентификатор того режиссёра, который снял фильм.

Заодно добавим в эту таблицу колонку `id`, в ней будут храниться первичные ключи (PK) записей этой таблицы. Пригодятся.

![](https://pictures.s3.yandex.net/resources/S2_132_1682532506.png)

Теперь можно получить из таблицы **video_products** запись о каком-нибудь фильме и, взяв значение из поля `director_id`, обратиться к нужной записи в таблице **directors**, получив из неё данные о режиссёре этого фильма. А потом вывести всю эту информацию на страницу сайта:

![](https://pictures.s3.yandex.net/resources/S2_129_1679563925.png)

Связи могут быть гораздо сложнее, чем в примере, но общий принцип остаётся неизменным.

## Не только SQL: альтернатива реляционным базам данных

Реляционные БД требуют чёткой структуры. Однако информация, которую надо хранить в базе, может быть очень разнородной. Для работы с большими объёмами разнородной информации были придуманы другие типы баз данных**.**

Такие базы называют **NoSQL** (Not Only SQL) — это не название технологии, а просто общее имя для достаточно разнородной группы баз данных.

Пионером в масштабном использовании нереляционных баз данных была компания Google. В начале 2000-х годов с их помощью решались проблемы масштабируемости и параллельной обработки данных в поисковой системе и в приложениях GMail, Maps, Earth.

Существует несколько типов NoSQL баз данных, например:

- базы типа **«ключ-значение»**. Типичный представитель — _Redis._ Все данные Redis хранит в виде словарей, в которых ключи связаны со значениями. Главное преимущество таких баз — очень быстрое получение данных. Заявляется до 100 тысяч операций чтения-записи в секунду на компьютере начального уровня производительности. Обычно подобные БД используются для кэширования;
- **документоориентированные** базы. Типичный представитель — _MongoDB_. Единицей хранения в такой базе данных выступает **документ** (по формату он похож на обычный словарь), в который может быть записано всё что угодно. Документы объединяются в коллекции, а те, в свою очередь, тоже могут быть объединены в какую-то более сложную иерархическую структуру. Система управления БД позволяет быстро находить нужную информацию в разнородных документах.

Существуют и другие типы NoSQL-баз, но это тема для отдельной, большой и увлекательной истории; в курсе по Django эти базы не пригодятся.

В этом курсе мы будем работать исключительно с реляционными базами данных. Начнём работу с SQLite, а позже поупражняемся с PostgreSQL.

Выберите ответы, которые безусловно относятся к реляционным базам данных.

Правильный ответ

Запись в таблице может содержать поля разного типа.

Да, так может быть (и чаще всего так и бывает). Взять хотя бы таблицу **video_products** из урока.

Правильный ответ

Запись в таблице может содержать поля одинакового типа.

Да, так может быть. Например, книга может быть описана полями «Автор», «Название» и «Описание» — всё это данные типа «строка»

Запись в таблице обязательно должна содержать поля одинакового типа.

Это было бы неудобно и нелогично. К счастью, это не так.

Правильный ответ

Каждой колонке таблицы должен быть присвоен тип данных.

Истинно так.

Правильный ответ

Строки одной таблицы могут ссылаться на записи в других таблицах.

Верно. Как правило, ссылающаяся запись хранит в отдельном поле идентификатор той записи, на которую ссылается.

Записи в таблицу можно добавлять или удалять, но нельзя перезаписать.

Ерунда какая. Кому нужна такая таблица, где нельзя исправить ошибку? В таблицах реляционных БД можно создавать, редактировать и удалять записи. Ну и читать, конечно же.

В реляционной базе данных обязательно должно быть больше одной таблицы.

Ничего подобного. Реляционная база данных вполне может содержать лишь одну таблицу — и нормально работать.

Неправильный ответ

Легко масштабируется разделением групп ключей на две части.

Нет, это определение справедливо только для NoSQL БД типа «ключ-значение».

Неожиданная ситуация: планировали изучать Python, а берёмся за изучение SQL. А самые любопытные студенты уже знают, что запросы к БД можно писать не на SQL, а прямо на Python — нужно лишь подключить определённую библиотеку, и она послужит переводчиком с Python на SQL и обратно.

Зачем же тратить время на этот странный язык? Зачем SQL питонисту?

Чтобы помучаться и постичь истинное смирение и дао программиста.

Нет. Путь программиста — узнавать новое, работать эффективнее и получать удовольствие от работы, а не страдать и мучаться.

Чтобы наконец-то стать лучше сына маминой подруги.

Нет, ерунда это всё. Соревноваться лучше с собой: вчера вы не знали SQL, завтра — будете знать, а это заметный плюс для любого разработчика. Значит, завтра вы снова победите. Вы лучше.

Тоже правильный ответ

Бэкенд предполагает взаимодействие с базами данных. А для такого взаимодействия нужен SQL.

Потому что запросы к базам данных нельзя писать на Python.

Вообще-то можно: для этого нужно подключить библиотеку, которая будет преобразовывать Python-код в SQL. Но SQL — основа и фундамент этих библиотек. Нужно знать, как устроен фундамент.

Правильный ответ

Чтобы понять, как устроены запросы — нужно сперва поработать с чистым SQL, и только после этого можно осознанно пользоваться «надстройками», позволяющими писать запросы к БД на Python.

Верно. Ответ — в вопросе, так уж вышло.

Тоже правильный ответ

При собеседовании на новое место работы обойти тему SQL не удастся: почти наверняка спросят.

Правильный ответ

Знание SQL поможет быстро исследовать или протестировать базу данных.

Верно: всегда проще ввести в консоль пару команд на SQL, чем ради этого создавать Python-проект с библиотекой.