# Фильтры в шаблонах: модифицируем контекст страницы

Данные из словаря `context` можно обработать в шаблоне ещё и встроенными в шаблонизатор инструментами — фильтрами. Фильтры могут изменять значения переменных.

В коде шаблона название фильтра пишется после ключа словаря или имени переменной, через символ `|`: `{{ variable|filter:параметры }}`.

### Фильтр length

Фильтр `length` вернёт длину строки или другой последовательности.

```jinja2
{{ long_string|length }} 
```

Если переменной `long_string` присвоить строку `«гиппопотомомонстросесквиппедалиофобия»`, то на месте `{{ long_string|length }}` в шаблон будет выведено число 37, по числу букв в слове.

### Фильтр safe

Если в шаблон передать строку с HTML-тегами и вывести её на страницу, то HTML-теги повылезают наружу и отобразятся как обычный текст.

```python
def product(request):
    template_name = 'catalog/product.html'
    product_name = '<h2>Iron carrot</h2>'
    product_description = '''
        <p>Настоящая 
          <b>железная морковь</b>,<br>
          без консервантов и красителей!
        </p>
        '''
    context = {
        'product_name': product_name,
        'product_description': product_description,
    }
    return render(request, template_name, context) 
```

```jinja2
<!-- catalog/product.html --> 
{{ product_name }}
{{ product_description }} 
```

Пользователю вернётся такая страница:

![](https://pictures.s3.yandex.net/resources/S01_109_1676930445.png)

Чтобы HTML-теги не вываливались на страницу, а выполняли своё предназначение (форматировали и структурировали содержимое), в шаблоне необходимо применить фильтр `safe`:

```jinja2
<!-- catalog/product.html --> 
{{ product_name|safe }}
{{ product_description|safe }} 
```

И страница будет выглядеть так:

![](https://pictures.s3.yandex.net/resources/S01_110_1676930457.png)

> Фильтр safe потенциально опасен. Если, например, применить этот фильтр для вывода сообщений пользователей — то злоумышленники смогут опубликовать свой HTML-код для сбора данных посетителей или для каких-то иных пакостей.

### Фильтр linebreaksbr

В Python для переноса строк, выводящихся на экран, применяются управляющие символы `\n`. Например, при выполнении такого кода

Скопировать кодPYTHON
```python
print('Настоящая железная морковь,\nбез консервантов и красителей!') 
```

…текст будет разбит построчно:

```bash
Настоящая железная морковь, 
без консервантов и красителей! 
```

Но если вывести на веб-страницу Python-строку, разбитую с помощью `\n`, переносы строк будут проигнорированы: ведь в HTML для переноса строк нужен тег `<br>`.

В Django Templates есть фильтр `linebreaksbr`. Он заменяет символы `\n` на HTML-теги `<br>`.

### Фильтр date

В словаре `context` передадим объект даты:

```python
import datetime


def timer(request):
    gogol_day = datetime.datetime(1809, 4, 1)
    context = {
        'gogol_day': gogol_day,
    }
    return render(request, 'time/gogol_birthday.html', context) 
```

Если вывести дату без форматирования, то получится что-то вроде `'Apr. 1, 2015, midnight'`. Это не лучший вариант: некрасиво и непривычно.

Фильтр `date` работает с объектами типа `date` и `datetime`: он позволяет отформатировать дату и время. Маски и форматы времени [описаны в документации](https://docs.djangoproject.com/en/3.2/ref/templates/builtins/#date), посмотрите.

Сделаем красиво:

```django
{{ gogol_day|date:"d.m.y" }} {# Выведет 01.04.09 #}
{{ gogol_day|date:"j.n.Y" }} {# Выведет 1.4.1809 #}
{{ gogol_day|date:"d M Y" }} {# Выведет 01 Apr 1809 #}
{{ gogol_day|date:"d E Y" }} {# Выведет 01 April 1809 #}       
```

### Несколько фильтров сразу

Фильтры можно объединять в цепочку:

```django
{{ armstrong_said|title|truncatewords:4 }} 
```

Например, переменная `armstrong_said` содержит строку `ЭТО ОДиН маЛЕНЬкий шаг для чеЛОВека и оГрОмНыЙ СКачОК для челоВЕЧЕсТВА`. Цепочка фильтров проведёт такие преобразования:

1. Сначала фильтр `title` преобразует регистр букв в формат «каждое слово с заглавной» (`Это Один Маленький Шаг Для Человека И Огромный Скачок Для Человечества`).
2. А потом фильтр `truncatewords:4` обрежет текст до первых четырёх слов.

В результате на страницу будет выведено `Это Один Маленький Шаг`.

В Django есть ещё множество встроенных фильтров, [почитайте о них в документации](https://docs.djangoproject.com/en/3.2/ref/templates/builtins/#ref-templates-builtins-filters), они обязательно пригодятся.