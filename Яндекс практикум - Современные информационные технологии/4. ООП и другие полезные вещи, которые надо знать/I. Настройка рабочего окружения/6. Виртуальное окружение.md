Когда вы впервые устанавливаете Python, вы создаете свое первичное глобальное окружение. Все пакеты, установленные в этом окружении, а также сам интерпретатор Python доступны любой программе на Python, которую вы запускаете на этом компьютере.

> **Глобальное окружение** — это базовое окружение Python, которое устанавливается на вашем компьютере как часть установки Python.

Однако обычно на компьютере разработчика одновременно хранится и находится в разработке множество разных проектов.

Для того чтобы обеспечить мирное сосуществование всех этих проектов на одном устройстве, были придуманы **виртуальные окружения**. Эти окружения представляют собой «изолированные пространства», специализированные виртуальные ячейки для каждого проекта.

Внутри каждого такого пространства располагается отдельный проект, для которого можно настроить уникальные параметры, такие как конкретная версия Python или необходимые библиотеки. Это позволяет работать над разными проектами на одном компьютере и не опасаться, что они будут конфликтовать между собой.

![На иллюстрации — семь питончиков: один — слушает музыку, другой — ухаживает за домашними растениями, третий — ждёт, пока заварится кофе в джезве, и так далее. Все питончики заняты своим делом и не мешают друг другу. Ведь каждый из них находится в изолированном пространстве.](https://pictures.s3.yandex.net/resources/image_1701328622.png)

В Python для создания виртуальных окружений существует несколько инструментов. Вот самые популярные из них:

- **venv** — это стандартный модуль, который идёт в комплекте с Python начиная с версии 3.3.
- **virtualenv** — это сторонний пакет, который предоставляет чуть больше возможностей по сравнению с venv.
- **conda** — это инструмент для управления пакетами и виртуальными окружениями, который является частью платформы Anaconda. Особенно полезен для работы с научными и аналитическими библиотеками Python.
- **pipenv** — совмещает управление пакетами (pip) и виртуальными окружениями (virtualenv).

Выбор конкретного инструмента зависит от ваших предпочтений, нужд проекта и используемой инфраструктуры. Однако чаще всего знакомство с виртуальными окружениями начинают именно с **venv** (от англ. _**v**irtual **env**ironment_, «виртуальное окружение»), так как он уже встроен в Python и не требует дополнительных установок.

Так и поступим.

## Создание виртуального окружения

Ранее в директории _Dev_ вы добавили проект _first_project_ с одним файлом _practicum.py_. Создадим виртуальное окружение для этого проекта.

Откройте проект в VS Code (в главном меню выберите **File → Open Folder**) и запустите терминал (в главном меню выберите **Terminal → New Terminal**):

![На скриншоте — интерфейс VS Code.](https://pictures.s3.yandex.net/resources/image_1702055596.png)

❗ Если вы работаете под Windows — убедитесь, что в терминале запустился Git Bash.

Теперь можно развернуть виртуальное окружение. Выполните в терминале команду:

```bash
# Папка, в которой должна быть выполнена команда: .../Dev/first_project.

# Команда для Windows:
python -m venv venv
# Это не опечатка! Первый 'venv' - это часть команды (имя модуля).
# А второй 'venv' - это имя директории, где оно будет создано.

# Команда для Linux и macOS:
python3 -m venv venv 
```

Смысл команды: Python,

- Запусти модуль venv, он развернёт виртуальное окружение.
- Назови каталог с виртуальным окружением «venv».

Имя виртуальному окружению можно задать любое, но в примерах курса будет использоваться «venv».

❗ Если вы работаете под Linux, то пакет может быть не установлен и при попытке запуска команды будет ошибка. В этом случае прежде чем начать работать с виртуальным окружением, необходимо установить соответствующий пакет. Например в Ubuntu это можно сделать командой `sudo apt install python3-venv`.

После выполнения этой команды в директории проекта появится папка _venv_, в ней хранятся служебные файлы.

Структура проекта должна быть такой:

```tree
Dev/
 └── first_project/
     ├── .vscode/         <-- Папка с настройками VS Code (её может и не быть).
     ├── venv/            <-- Папка виртуального окружения.
     └── practicum.py     <-- Файл с вашей программой. 
```

Когда вы создаете новое виртуальное окружение, в VS Code появляется подсказка, позволяющая связать его с текущим проектом.

![На скриншоте — текст подсказки: ‘We noticed a new virtual environment has been created. Do you want to select it for the workspace folder?’ Пользователь может выбрать один из трёх вариантов — Yes, No, Do not show again.](https://pictures.s3.yandex.net/resources/image_1703842252.png)

Эта возможность вам ещё пригодится, но сейчас — проигнорируйте предложение; сначала разберемся как работает виртуальное окружение без участия редактора кода.

## Активация виртуального окружения

Виртуальное окружение готово к использованию, однако пока ещё не работает. Для начала работы его необходимо активировать; до активации конкретного виртуального окружения вы работаете в глобальном окружении.

Для этого в VS Code, находясь в корневой директории проекта _first_project_, введите в терминал команду:

```bash
# Директория, в которой вы должны находиться: ...Dev/first_project.

# Команда для Windows:
source venv/Scripts/activate

# Для Linux и macOS:
source venv/bin/activate 
```

После активации виртуального окружения имя этого окружения, как правило, отображается в начале командной строки. Например, если у вас окружение в директории _venv_, то приглашение к вводу команд в терминале Git Bash под Windows может выглядеть примерно так:

```bash
(venv)
имя_пользователя@имя_компьютера MINGW64 /c/dev/first_project
$ 
```

На разных операционных системах отображение может различаться — например, для macOS активированное окружение может выглядеть так:

```bash
(venv) имя_пользователя@имя_компьютера first_project % 
```

Для **каждого проекта** рекомендуется создавать и использовать отдельное виртуальное окружение.

## Лайфхак

Необязательно каждый раз вводить команду активации вручную и полностью. Используйте для этого автодополнение (клавиша **Tab**):

```bash
# Для Windows:
sou -> Tab -> пробел -> v -> Tab -> s -> Tab -> a -> Tab -> Enter

# Для Linux или macOS:
sou -> Tab -> пробел -> v -> Tab -> b -> Tab -> a -> Tab -> Enter 
```

![На скринкасте демонстрируется, как работает автодополнение с помощью клавиши Tab.](https://pictures.s3.yandex.net/resources/1_1709563352.gif)

Виртуальное окружение для проекта _first_project_ создано и активировано. Теперь все команды, которые вы введёте в терминал, будут выполняться в этом окружении.

Деактивировать виртуальное окружение можно командой:

```bash
deactivate 
```

Можно даже полностью уничтожить виртуальное окружение — для этого деактивируйте окружение и после этого просто удалите папку _venv_ из корневой папки проекта.

## Выбор версии Python для окружения

На вашем компьютере может быть установлено несколько версий Python. При создании нового виртуального окружения будет использована та версия, которая установлена по умолчанию для вашей операционной системы.

Тем не менее иногда возникает необходимость использовать конкретную версию Python. Например, вы хотите запустить проект, созданный на Python 3.7, а ваша системная версия — 3.9. В такой ситуации лучше создать виртуальное окружение с необходимой версией интерпретатора.

Процесс создания виртуального окружения с указанием конкретной версии Python может различаться в зависимости от операционной системы.

Windows

За переключение между версиями Python на Windows отвечает утилита **Python Launcher**. Она устанавливается в операционную систему вместе с интерпретатором.

Чтобы посмотреть список установленных версий Python на компьютере, введите в терминал команду:

```bash
py -0 
```

В результате выведется список доступных версий Python, например такой:

![На скриншоте — интерфейс терминала со списком доступных версий Python: -3.9-64 и 3.7-32.](https://pictures.s3.yandex.net/resources/image_1701328796.png)

Чтобы узнать, какая версия установлена версией по умолчанию, понадобится команда:

```bash
python --version 
```

Например, такой вывод означает, что версией по умолчанию установлена 3.9, именно она будет задействована для создания нового виртуального окружения:

![На скриншоте — интерфейс терминала. Вывод в терминале: Python 3.9.0.](https://pictures.s3.yandex.net/resources/image_1701328805.png)

Предположим, что вам нужно окружение не с версией по умолчанию, а с версией 3.7, которая установлена в системе. Создать такое виртуальное окружение поможет команда:

```bash
py -3.7 -m venv venv 
```

Linux

Чтобы увидеть список всех установленных в систему версий Python, нужно ввести в терминал команду:

```bash
sudo ls -ls /usr/bin/python* 
```

![На скриншоте — интерфейс терминала. Вывод даёт понять, что в систему установлено две версии Python: 3.8 и 3.9.](https://pictures.s3.yandex.net/resources/image_1701328835.png)

Если вы хотите использовать в работе определённую версию Python, добавьте к команде создания виртуального окружения номер этой версии. То есть виртуальное окружение с версией Python по умолчанию создаётся командой:

```bash
python3 -m venv venv 
```

А с версией 3.8 командой:

```bash
python3.8 -m venv venv 
```

macOS

Чтобы увидеть список всех установленных в систему версий Python, нужно ввести в терминал команду:

```bash
brew search python 
```

![На скриншоте — интерфейс терминала с результатом работы команды brew search python.](https://pictures.s3.yandex.net/resources/image_1701328862.png)

Версию Python, установленную по умолчанию, покажет команда:

```bash
python3 --version 
```

![На скриншоте — интерфейс терминала. Вывод в терминале: Python 3.9.10.](https://pictures.s3.yandex.net/resources/image_1701328874.png)

Для создания виртуального окружения с определённой версией Python нужно установить ссылку на эту версию в системе. Для этого необходимо деактивировать ссылку к текущей версии командой:

```bash
brew unlink python@3.9 
```

А затем указать необходимую версию, например 3.7:

```bash
brew link python@3.7 
```

![На скриншоте — интерфейс терминала. Показано, как отработаю перечисленные ранее команды. Последний вывод: Python 3.7.12.](https://pictures.s3.yandex.net/resources/image_1701328887.png)

Теперь вы можете выбирать нужную версию Python и настраивать виртуальное окружение для любого своего проекта.

## VS Code и выбор версии Python

При запуске файлов через графический интерфейс в VS Code (при нажатии на кнопку «Выполнить код») редактор будет использовать тот интерпретатор Python, который установлен в системе по умолчанию. Однако он может не совпадать с той версией Python, которая вам требуется.

Вы можете настроить VS Code так, чтобы он использовал нужную вам версию Python, например из определённого виртуального окружения.

Откройте проект в VS Сode и нажмите комбинацию горячих клавиш **Ctrl+Shift+P** (или **Command+Shift+P** для macOS). В появившейся строке начните печатать _python: sel_; выберите пункт **Python Select Interpreter**:

![На скриншоте — интерфейс VS Code: строка поиска и выпадающий список.](https://pictures.s3.yandex.net/resources/image_1702055654.png)

На следующем шаге выберите пункт **Select at workspace level**:

![На скриншоте — интерфейс VS Code: приглашение выбрать один из двух пунктов — Dev ~/ или Select at workspace level.](https://pictures.s3.yandex.net/resources/image_1702055662.png)

Появится список всех доступных версий Python. Выберите нужную версию, например Python 3.9, и после этого именно она будет автоматически вызываться при запуске кода через Visual Studio Code.

![На скриншоте — интерфейс VS Code: окно Select Interpreter и выпадающий список с вариантами.](https://pictures.s3.yandex.net/resources/image_1713160240.png)

Выбранная версия интерпретатора отображается в правой нижней части окна Visual Studio Code.

![На скриншоте — интерфейс VS Code. Выделена область в правой нижней части окна со следующей информацией: 3.9.10 (’env’: venv).](https://pictures.s3.yandex.net/resources/image_1707726617.png)

### И что в итоге?

Начинающему разработчику важно понимать, что виртуальные окружения в Python — не только удобный инструмент, но и ключевой компонент эффективной и безопасной работы с проектами.

Вот основные моменты, которые вам следует запомнить:

1. **Создавайте отдельное окружение для каждого проекта.** Это помогает избежать конфликтов между проектами.
2. **Активация и деактивация окружений.** Всегда активируйте соответствующее виртуальное окружение перед началом работы над проектом и деактивируйте его по завершении. В большинстве редакторов кода можно использовать [автоматическую активацию и деактивацию соответствующего виртуального окружения при открытии и закрытии проекта](https://code.visualstudio.com/docs/python/environments#_create-a-virtual-environment-in-the-terminal).