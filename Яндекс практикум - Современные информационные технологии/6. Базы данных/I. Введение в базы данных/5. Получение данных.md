# Получение данных

В этом уроке вернёмся к базе данных из файла _db_video.sqlite_. Сейчас в ней всего лишь одна таблица — **video_products**:

![](https://pictures.s3.yandex.net/resources/S2_133_1_1682533044.png)

### Выборка по столбцам

Одно из наиболее используемых ключевых слов в SQL — `SELECT` (англ. «выбрать»). Эта инструкция позволяет запрашивать данные из таблиц и при необходимости приводить полученные результаты к нужному виду.

После ключевого слова `SELECT` в запросе указывают названия полей, значения которых должны вернуться в ответе; после `FROM` (англ. «из») — названия таблиц, где надо искать данные.

<<<<<<< HEAD:Education/Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md
```sql
=======
```SQL
>>>>>>> 335713cc75f2671df7efb320d83d056298be94bb:Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md
SELECT <перечень столбцов, значения из которых надо получить>
FROM <перечень таблиц, из которых надо получить данные>; 
```

В ответ на запрос `SELECT` данные возвращаются в структурированном табличном виде. К такой таблице можно снова применить запрос `SELECT`, то есть запросы могут быть «вложены» друг в друга, а их результаты — объединены. Вложенные запросы называют **подзапросами**.

Чтобы не путаться в понятиях «таблица БД» и «таблица с ответом», возвращаемые данные будем называть **«результирующая выборка»** или просто **«выборка»**.

<<<<<<< HEAD:Education/Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md
В ответ на запрос

```sql
=======
```SQL
>>>>>>> 335713cc75f2671df7efb320d83d056298be94bb:Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md
-- Вернуть только поля title, release_year
SELECT title,
       release_year 
-- из всех записей в таблице video_products
FROM video_products; 
```

…SQL вернёт такую результирующую выборку:

![](https://pictures.s3.yandex.net/resources/10_1685546642.png)

Отобразить результирующую выборку в виде таблицы можно прямо в консоли, при работе через оболочку sqlite3.

Два шага к табличному отображению выборки

<<<<<<< HEAD:Education/Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md
1. Через консоль подключитесь к БД: `sqlite3 db_video.sqlite`.
2. Переведите отображение в табличный вид: `.mode table` (не ждите явного ответа на эту команду).

Готово! Сделайте запрос, например, `SELECT title, release_year FROM video_products;`. Посмотрите, в каком виде выводится ответ.

При перезапуске оболочки sqlite3 ответы вновь будут отображаться в обычном текстовом виде, через разделитель `|`.

=======
>>>>>>> 335713cc75f2671df7efb320d83d056298be94bb:Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md
Python «под капотом» превращает результирующую выборку в итерируемый объект, который можно перебрать в цикле; элементами этого объекта будут кортежи со значениями полей, полученных из БД.

Прочитаем и выведем в консоль все поля всех записей из таблицы **video_products**:

```python
import sqlite3

con = sqlite3.connect('db_video.sqlite')
cur = con.cursor()

# Запрашиваем все столбцы всех записей из таблицы video_products;
# символ * после SELECT означает "верни все поля найденных записей".
results = cur.execute('''
  SELECT *
  FROM video_products;
''')

# В results получим итерируемый объект, который можно перебрать циклом:
for result in results:
    print(result)

# При получении данных из таблицы не нужно вызывать метод con.commit()!
con.close() 
```

В результате в консоли будут напечатаны кортежи:

<<<<<<< HEAD:Education/Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md
```python
=======
```bash
>>>>>>> 335713cc75f2671df7efb320d83d056298be94bb:Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md
(1, 'Весёлые мелодии', 'Мультсериал', 1930)
(2, 'Безумные мелодии Луни Тюнз', 'Мультсериал', 1931)
(3, 'Кто подставил кролика Роджера', 'Фильм', 1988)
(4, 'Хороший, плохой, злой', 'Фильм', 1967)
(5, 'Последний киногерой', 'Фильм', 1993)
(6, 'Она написала убийство', 'Сериал', 1984)
(7, 'Лас-Вегас', 'Сериал', 2003)
(8, 'Паркер Льюис не проигрывает', 'Сериал', 1990)
(9, 'Розовая пантера: Контроль за вредителями', 'Мультфильм', 1969)
(10, 'Койот против Acme', 'Фильм', 2023) 
```

Обычно при запросах к БД разработчику не нужны все поля записей. Например, на странице сайта требуется показать только названия и год выпуска всех фильмов из базы данных. В этой ситуации лучше запросить из базы не все поля, а лишь два из них; названия столбцов перечисляют через запятую после `SELECT`.

Поля будут выгружены из таблицы в том порядке, как они указаны в запросе.

```python
...

results = cur.execute('''
    SELECT title,
           release_year
    FROM video_products;
''')

... 
```

Если теперь перебрать в цикле и распечатать содержимое `results` — будут напечатаны десять кортежей, но в каждом кортеже будет только два элемента: название фильма и год выпуска.

```python
('Весёлые мелодии', 1930)
('Безумные мелодии Луни Тюнз', 1931)
('Кто подставил кролика Роджера', 1988)
('Хороший, плохой, злой', 1967)
('Последний киногерой', 1993)
('Она написала убийство', 1984)
('Лас-Вегас', 2003)
('Паркер Льюис не проигрывает', 1990)
('Розовая пантера: Контроль за вредителями', 1969)
('Койот против Acme', 2023) 
```

### Выборка по строкам

В запросе можно отфильтровать записи, удовлетворяющие заданным условиям. Найдём все фильмы, снятые после 1980 года.

Для фильтрации можно применить ключевое слово `WHERE`:

<<<<<<< HEAD:Education/Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md
```sql
=======
```SQL
>>>>>>> 335713cc75f2671df7efb320d83d056298be94bb:Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md
SELECT title,
       release_year
FROM video_products
-- ГДЕ значение поля release_year больше 1980
WHERE release_year > 1980; 
```

![](https://pictures.s3.yandex.net/resources/S02_130_1678062715.png)

В результирующую выборку попадут только те записи, которые соответствуют условиям, описанным после `WHERE`.

Для описания условий запроса применяют специальные операторы — большинство из них вам знакомы.

Вот несколько популярных операторов:

<<<<<<< HEAD:Education/Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md
- `=` — оператор **сравнения**, а не присваивания (это аналог `==` в Python).
    ```sql
=======
- `=` — оператор **сравнения**, а не присваивания (это аналог `==` в Python). 
    ```SQL
>>>>>>> 335713cc75f2671df7efb320d83d056298be94bb:Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md
      SELECT title
      FROM video_products
      -- Найдём фильмы, выпущенные в 1988:
      WHERE release_year = 1988;
<<<<<<< HEAD:Education/Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md
       
    ```
    
- `>` , `<` — «больше» и «меньше», `>=` , `<=` — «больше или равно», «меньше или равно».
    ```sql
=======
    ```
    
- `>` , `<` — «больше» и «меньше», `>=` , `<=` — «больше или равно», «меньше или равно».
    ```SQL
>>>>>>> 335713cc75f2671df7efb320d83d056298be94bb:Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md
      SELECT title
      FROM video_products
      -- Найдём фильмы, выпущенные позже 1988:
      WHERE release_year > 1988;
       
    ```
    
<<<<<<< HEAD:Education/Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md
- `<>` — «не равно». В SQLite в качестве оператора неравенства можно применять и `!=`.
    ```sql
=======
- `<>` — «не равно». В SQLite в качестве оператора неравенства можно применять и `!=`.    
    ```SQL
>>>>>>> 335713cc75f2671df7efb320d83d056298be94bb:Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md
      SELECT title
      FROM video_products
      -- Найдём фильмы, выпущенные в любом году, кроме 1988:
      WHERE release_year <> 1988;
       
    ```
    
- `BETWEEN ... AND ...` — «между», для проверки значения в диапазоне: `BETWEEN начало_диапазона AND конец_диапазона`. Начало и конец диапазона включены в условие.
<<<<<<< HEAD:Education/Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md
    
    ```sql
=======
    ```SQL
>>>>>>> 335713cc75f2671df7efb320d83d056298be94bb:Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md
      SELECT title
      FROM video_products
      -- Найдём фильмы, выпущенные с 1980 по 1990 год включительно:
      WHERE release_year BETWEEN 1980 AND 1990;
       
    ```
    
<<<<<<< HEAD:Education/Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md
- `IN` — вхождение в список:
    
    ```sql
=======
- `IN` — вхождение в список:    
    ```SQL
>>>>>>> 335713cc75f2671df7efb320d83d056298be94bb:Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md
      SELECT title
      FROM video_products
      -- Найдём в базе все фильмы, 
      -- у которых значение поля product_type - 'Сериал' или 'Фильм':
      WHERE product_type IN ('Сериал', 'Фильм');
       
    ```
    
<<<<<<< HEAD:Education/Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md
- `LIKE` — поиск строки по шаблону. В шаблонах можно применять символы-«маски»: знак процента `%` заменяет любой **набор символов**; символ подчёркивания `_` заменяет **один любой символ** (цифру, букву, пробел, пунктуационный или любой другой символ).

    ```sql
      SELECT title
      FROM video_products
      WHERE product_type LIKE 'Мульт%';
       
=======
- `LIKE` — поиск строки по шаблону. В шаблонах можно применять символы-«маски»: знак процента `%` заменяет любой **набор символов**; символ подчёркивания `_` заменяет **один любой символ** (цифру, букву, пробел, пунктуационный или любой другой символ).    
	``` SQL
      SELECT title
      FROM video_products
      WHERE product_type LIKE 'Мульт%';
>>>>>>> 335713cc75f2671df7efb320d83d056298be94bb:Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md
    ```
    
    Этот запрос выберет все записи, где значение поля `product_type` — «**Мульт**фильм» или «**Мульт**сериал». Символы `_` и `%` можно комбинировать в одном шаблоне.
    
    При сравнении значения поля с числом — всё просто: `WHERE название_поля = 5`.
    
    Но если сравниваются строковые данные, то набор символов берут в одинарные кавычки: `WHERE название_поля = 'Сериал'`.
    
<<<<<<< HEAD:Education/Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md
    > В разных СУБД могут быть различные наборы текстовых масок и дополнительные функции для поиска.
    

Есть и другие операторы, их описание можно посмотреть в справочниках, например, [в этом](https://www.sqlite.org/optoverview.html#where_clause_analysis)
=======
    В разных СУБД могут быть различные наборы текстовых масок и дополнительные функции для поиска.
    

Есть и другие операторы, их описание можно посмотреть в справочниках, например, [в этом](https://www.sqlite.org/optoverview.html#where_clause_analysis).

>>>>>>> 335713cc75f2671df7efb320d83d056298be94bb:Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md
Синтаксис SQL-запроса позволяет использовать в `WHERE` множество условий одновременно. Для объединения сразу нескольких условий используются операторы `AND`, `OR` или `NOT`, они работают так же, как в Python.

```python
...

results = cur.execute('''
SELECT title,
       release_year
FROM video_products
WHERE (release_year BETWEEN 1965 AND 1990) AND product_type LIKE '%ильм';
''')

for result in results:
    print(result)
... 
```

Если выполнить этот код — вернётся такой результат:
<<<<<<< HEAD:Education/Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md

```python
=======
```bash
>>>>>>> 335713cc75f2671df7efb320d83d056298be94bb:Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md
('Кто подставил кролика Роджера', 1988)
('Хороший, плохой, злой', 1967)
('Розовая пантера: Контроль за вредителями', 1969) 
```

Когда используется несколько условий, каждое из них проверяется на истинность, и на выходе получается либо значение `TRUE`, если утверждение истинно, либо `FALSE`, если утверждение ложно. Затем каждый из логических операторов действует по своим правилам:

- `AND` возвращает `TRUE`, только если оба логических значения тоже `TRUE`.
- `OR` возвращает `TRUE`, если хотя бы одно логическое значение тоже `TRUE`.
- `NOT` меняет значение выражения на противоположное: `TRUE` на `FALSE`, а `FALSE` на `TRUE`.

## Приоритет

Логические операторы имеют разный приоритет выполнения: оператор `NOT` выполняется в первую очередь, следующим выполняется оператор `AND`; у оператора `OR` — самый низкий приоритет. Для объединения условий в группу используются скобки `()`: операции в скобках, как и в арифметике, выполняются прежде всего.

При выполнении запроса…
<<<<<<< HEAD:Education/Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md

```sql
=======
```SQL
>>>>>>> 335713cc75f2671df7efb320d83d056298be94bb:Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md
SELECT title,
       product_type,
       release_year
FROM video_products
WHERE product_type = 'Фильм' OR product_type = 'Сериал' AND release_year = 1993; 
```

…результат будет такой:
<<<<<<< HEAD:Education/Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md

```python
=======
```bash
>>>>>>> 335713cc75f2671df7efb320d83d056298be94bb:Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md
('Кто подставил кролика Роджера', 'Фильм', 1988)
('Хороший, плохой, злой', 'Фильм', 1967)
('Последний киногерой', 'Фильм', 1993)
('Койот против Acme', 'Фильм', 2023) 
```

> Мы предполагаем, что все запросы выполняются из кода на Python при помощи библиотеки sqlite3, поэтому и ответы приводим в Python-формате.

Изменим приоритеты — возьмём в скобки выражение с оператором OR:
<<<<<<< HEAD:Education/Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md

=======
>>>>>>> 335713cc75f2671df7efb320d83d056298be94bb:Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md
```sql
SELECT title,
       product_type,
       release_year
FROM video_products
WHERE (product_type = 'Фильм' OR product_type = 'Сериал') AND release_year = 1993; 
```

Результат станет совершенно иным:
<<<<<<< HEAD:Education/Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md

```python
=======
```bash
>>>>>>> 335713cc75f2671df7efb320d83d056298be94bb:Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md
('Последний киногерой', 'Фильм', 1993) 
```

### Специальное значение NULL

Значение `NULL` означает отсутствие данных. Основная особенность `NULL` в том, что это значение не равно ничему; любая попытка сравнить `NULL` с чем угодно, даже с `NULL`, вернёт `False`.

Для работы с `NULL` используют отдельные операторы — `IS NULL` и `IS NOT NULL`. Для значения `NULL` оператор `IS NULL` вернёт `True`; оператор `IS NOT NULL` вернёт `True`, если значение не равно `NULL`.

Операторы `IS NULL` и `IS NOT NULL` можно применять в условиях, чтобы фильтровать данные.

Добавим в таблицу **video_products** колонку `gross`: в ней будем хранить сумму кассовых сборов каждого фильма. Но какие-то фильмы не собрали вообще ничего (или мы просто не знаем о сборах) — и у них в поле `gross` стоит значение `NULL`.

![](https://pictures.s3.yandex.net/resources/S2_135_1682533087.png)

Какие строки попадут в выборку в результате этого запроса к таблице **video_products**?
<<<<<<< HEAD:Education/Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md

=======
>>>>>>> 335713cc75f2671df7efb320d83d056298be94bb:Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md
```sql
SELECT *
FROM video_products
WHERE gross = NULL; 
```

Все строки. Условие `gross = NULL` будет проигнорировано.

Условие `gross = NULL` будет применено, однако оно никогда не будет истинным, ведь значение `NULL` не равно ничему, даже самому себе.

Тоже правильный ответ

Выборка будет пустой.

Неправильный ответ

Строки, у которых в поле `gross` стоит `NULL`.

Нет. Значение `NULL` не равно ничему, даже самому себе.

Возникнет синтаксическая ошибка, и запрос выполнен не будет.

Запрос будет выполнен, ошибки не возникнет. Но запрос вернёт пустой результат.

<<<<<<< HEAD:Education/Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md
>[!question] Вопрос Какие строки попадут в выборку в результате этого запроса к таблице **video_products**? ` SELECT * FROM video_products WHERE gross = NULL;` 
>
>>[!fail] Все строки. Условие `gross = NULL`будет проигнорировано.
>>Условие `gross = NULL` будет применено, однако оно никогда не будет истинным, ведь значение `NULL`не равно ничему, даже самому себе.
>
>>[!success] Выборка будет пустой.
>
>>[!fail] Строки, у которых в поле `gross`стоит`NULL`.
>> Нет. Значение `NULL` не равно ничему, даже самому себе.
>
>>[!fail] Возникнет синтаксическая ошибка, и запрос выполнен не будет. 
>>Запрос будет выполнен, ошибки не возникнет. Но запрос вернёт пустой результат.

=======
>>>>>>> 335713cc75f2671df7efb320d83d056298be94bb:Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md
### Получение уникальных значений из столбца

Чтобы получить уникальные значения из заданного столбца — применяют инструкцию `DISTINCT`.

Выберем уникальные значения из колонки `product_type` в таблице `video_products`:
<<<<<<< HEAD:Education/Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md

```sql
=======
```SQL
>>>>>>> 335713cc75f2671df7efb320d83d056298be94bb:Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md
-- ВЫБРАТЬ УНИКАЛЬНЫЕ ЗНАЧЕНИЯ из колонки product_type:
SELECT DISTINCT product_type
FROM video_products; 
```

Получим перечень типов фильмов, без повторов:
<<<<<<< HEAD:Education/Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md

```python
=======
```bash
>>>>>>> 335713cc75f2671df7efb320d83d056298be94bb:Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md
('Мультсериал',)
('Фильм',)
('Сериал',)
('Мультфильм',) 
```

### Порядок элементов в запросе

В SQL-запросах важно указывать элементы запроса в правильном порядке. Логика работы такая:

1. После ключевого слова `SELECT` указываем столбцы...
2. …эти столбцы нужно взять из таблицы, имя которой указано после `FROM`;
3. в столбцах выбираем значения, которые соответствуют условиям `WHERE`.
<<<<<<< HEAD:Education/Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md

=======
>>>>>>> 335713cc75f2671df7efb320d83d056298be94bb:Яндекс практикум - Современные информационные технологии/Базы данных/I. Введение в базы данных/5. Получение данных.md
```sql
SELECT <перечень столбцов через запятую>
FROM <название таблицы>
WHERE <условия>; 
```

SQL строг, и неправильный порядок операторов вызовет ошибку.

В SQL много ключевых слов, но `SELECT`, `FROM` и `WHERE` присутствуют практически в каждом запросе на получение информации.

![](https://pictures.s3.yandex.net/resources/sprint2_picture12x_1678063001.png)

Эти волшебные три слова — фундаментальные; все остальные, более сложные запросы — просто надстройки над ними.