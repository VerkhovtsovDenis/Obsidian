# SQL: язык структурированных запросов

Основной инструмент для работы с реляционными базами данных — специальный язык запросов: **Structured Query Language**, **SQL.**

> SQL произносится «эс-кью-эл».

Иногда аббревиатуру SQL в шутку расшифровывают как _Simple Query Language_ — «простой язык запросов». Подвох в том, что SQL — это довольно сложный язык.

![](https://pictures.s3.yandex.net/resources/7_1678058231.png)

У SQL своеобразный синтаксис: в нём описываются условия **запросов**-команд: «база данных, сделай то-то и то-то с такими-то условиями».

Посмотрим, как работает база данных, в которой есть таблица **video_products**:

![](https://pictures.s3.yandex.net/resources/S2_133_1682532640.png)

Данные из таблицы можно получить и использовать в проекте (например, вывести информацию на страницу сайта).

Для получения данных можно использовать, например, вот такой **SQL-запрос**:

```sql
-- Верни названия (значения поля title) тех фильмов из таблицы video_products, 
-- у которых в поле product_type записано «Фильм», а дата выпуска — ранее 1990 года
SELECT title FROM video_products WHERE product_type = 'Фильм' AND release_year < 1990; 
```

В ответ на запрос СУБД вернёт запрошенные данные:

```sql
-- Ваш заказ готов!
Кто подставил кролика Роджера
Хороший, плохой, злой 
```

Кстати, в SQL тоже есть комментарии. Ставьте двойной дефис в начале строки — и комментируйте на здоровье. Есть и многострочные комментарии: они начинаются со слеша и звёздочки `/*` и заканчиваются ими же, в обратном порядке: `*/`.

Язык SQL — это стандарт, который применяется в реляционных базах данных. В разных СУБД могут применяться дополнительные команды SQL, расширяющие стандартные возможности языка. Такие расширенные версии называют «диалектами» SQL.

В этом курсе мы будем применять команды, которые универсальны для всех диалектов SQL.

Для составления SQL-запроса используют различные элементы, например, ключевые слова, идентификаторы и операторы. 

- **Ключевые слова** — это слова, которые определены в языке SQL. Например, `SELECT`, `COUNT`, `ASC`, `KEY`.
- **Идентификаторы** — это имена объектов базы данных, таких как таблицы или столбцы. Например, `video_products` или `title`.
- **Оператор** — это символ или слово, указывающий на действие, которое выполняется над одним или несколькими выражениями. Например, `>`, `<`, `=`, `LIKE`, `IN`, `AND`; есть и другие.

Важная рекомендация: не следует называть базы данных, таблицы или поля таблиц ключевыми словами или названиями операторов.

## Стиль оформления SQL-запросов

_Чтоб мудро жизнь прожить, знать надобно немало,_

_Два важных правила запомни `для начала`:_

1. Ключевые слова пишутся в верхнем регистре: это позволяет визуально отделить их от идентификаторов.
2. Каждое ключевое слово (а их в запросе может быть много) пишется с новой строки.

![](https://pictures.s3.yandex.net/resources/sprint2_picture32x_1679561694.png)

Вот SQL-запрос, написанный без форматирования:

```sql
select catalog_icecream.id,catalog_icecream.is_published,catalog_icecream.is_on_main,catalog_icecream.title,catalog_icecream.category_id,catalog_icecream.description,catalog_mainimage.id,catalog_mainimage.is_published,catalog_mainimage.image,catalog_mainimage.title,catalog_mainimage.ice_cream_id from catalog_icecream left outer join catalog_mainimage on catalog_icecream.id = catalog_mainimage.ice_cream_id where catalog_icecream.is_on_main and catalog_icecream.is_published; 
```

Этот запрос будет выполнен и успешно вернёт запрошенную информацию, но прочесть такой код — сложная задача даже для квалифицированного разработчика.

Тот же запрос можно написать иначе:

```sql
SELECT catalog_icecream.id,
       catalog_icecream.is_published,
       catalog_icecream.is_on_main,
       catalog_icecream.title,
       catalog_icecream.category_id,
       catalog_icecream.description,
       catalog_mainimage.id,
       catalog_mainimage.is_published,
       catalog_mainimage.image,
       catalog_mainimage.title,
       catalog_mainimage.ice_cream_id
FROM catalog_icecream
LEFT OUTER JOIN catalog_mainimage
ON catalog_icecream.id = catalog_mainimage.ice_cream_id
WHERE catalog_icecream.is_on_main AND catalog_icecream.is_published; 
```

Читать стало проще, теперь визуально понятно, где в запросе ключевые слова, а где — названия таблиц и полей.

В разных командах разработчиков стиль форматирования SQL-запросов может отличаться, но общие принципы обычно сохраняются.

Оформить запрос по всем правилам можно вручную или с помощью SQL-форматера, например — [SQLFormat](https://sqlformat.org/). Есть и [рекомендации, описывающие правила именования таблиц и столбцов](https://www.sqlstyle.guide/ru/#%D1%82%D0%B0%D0%B1%D0%BB%D0%B8%D1%86%D1%8B) в них.

Какой запрос соответствует хорошему стилю?
```sql
Select track_id, title, composer, milliseconds / 60000 as minutes FROM tracks
where milliseconds > 350000; 
``` 

В таком запросе сложно ориентироваться. Автор кода не разбил его на строки и зачем-то использовал разный регистр для операторов.
```sql
select track_id, 
       title,
       composer, 
       milliseconds / 60000 as minutes
from tracks
where milliseconds > 350000; 
``` 

Переносы строк на месте, это уже половина дела. Но операторы написаны в нижнем регистре, и их легко спутать с ключевыми словами.

Правильный ответ
```sql
SELECT track_id,
       title,
       composer,
       milliseconds / 60000 AS minutes
FROM tracks
WHERE milliseconds > 350000; 
``` 

Запрос, что надо! Операторы написаны прописными буквами, переносы на месте.

```sql
SELECT track_id, title, composer, milliseconds / 60000 AS minutes FROM tracks
WHERE milliseconds > 350000; 
``` 

Неплохой запрос, но нужно расставить переносы: тогда ориентироваться в коде станет проще.